<!-- ‚öîÔ∏è –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω Battlefield -->
<div id="screen-battlefield-main" class="screen">
  <p class="subtext">
    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä Battlefield.<br><br>
    –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π –æ—Ä—É–∂–∏–µ, –ø—Ä–æ—Ö–æ–¥–∏ –∏—Å–ø—ã—Ç–∞–Ω–∏—è –∏ —Å–ª–µ–¥–∏ –∑–∞ –Ω–æ–≤—ã–º–∏ –º–µ—Ç–∞-—Å–±–æ—Ä–∫–∞–º–∏.
  </p>

  <div id="bf-user-info" class="user-info-block"></div>
  <h1>Battlefield</h1>

  <div id="bf-role-buttons" class="form-section">
    <!-- üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
    <div id="bf-user-buttons" class="button-grid three-column">
      <div class="card-btn is-visible" id="bf-show-builds-btn">
        <i class="fas fa-eye"></i>
        <span>–í—Å–µ —Å–±–æ—Ä–∫–∏</span>
      </div>
      <div class="card-btn is-visible" id="bf-challenges-btn">
        <i class="fas fa-flag"></i>
        <span>–ò—Å–ø—ã—Ç–∞–Ω–∏—è</span>
      </div>
      <div class="card-btn is-visible" id="bf-settings-btn">
        <i class="fas fa-cog"></i>
        <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã</span>
      </div>
    </div>

    <!-- üõ° –ê–¥–º–∏–Ω -->
    <div id="bf-admin-buttons">
      <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ -->
      <div class="button-grid three-column">
        <div class="card-btn is-visible" id="bf-weapons-db-btn">
          <i class="fas fa-database"></i>
          <span>–ë–∞–∑–∞ –æ—Ä—É–∂–∏–π</span>
        </div>
        <div class="card-btn is-visible" id="bf-challenges-db-btn">
          <i class="fas fa-clipboard-list"></i>
          <span>–ë–∞–∑–∞ –∏—Å–ø—ã—Ç–∞–Ω–∏–π</span>
        </div>
        <div class="card-btn is-visible" id="bf-modules-dict-btn">
          <i class="fas fa-list"></i>
          <span>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–æ–¥—É–ª–µ–π</span>
        </div>
      </div>

      <!-- –¢—Ä–µ—Ç—å—è —Å—Ç—Ä–æ–∫–∞ -->
        <div class="button-grid three-column">
          <div class="card-btn is-visible" id="bf-add-build-btn">
            <i class="fas fa-plus"></i>
            <span>–î–æ–±–∞–≤–∏—Ç—å —Å–±–æ—Ä–∫—É</span>
          </div>
        
          <div class="card-btn is-visible" id="bf-add-challenge-btn">
            <i class="fas fa-trophy"></i>
            <span>–î–æ–±–∞–≤–∏—Ç—å –∏—Å–ø—ã—Ç–∞–Ω–∏–µ</span>
          </div>
        
          <div class="card-btn is-visible" id="bf-game-settings-btn">
            <i class="fas fa-cog"></i>
            <span>–†–µ–¥–∞–∫—Ç–æ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫</span>
          </div>
        </div>


      <!-- üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
      <div class="global-home-button" style="display:block;">
        <button class="btn" onclick="showScreen('screen-home')">üè† –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ</button>
      </div>
    </div>
  </div>
</div>


<!-- üì¶ –°–ø–∏—Å–æ–∫ —Å–±–æ—Ä–æ–∫ -->
<div id="screen-bf-builds" class="screen" style="display:none;">
  <div class="filters-row">
    <div class="form-section" style="width:50%;">
      <select id="bf-weapon-filter" class="form-input">
        <option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
        <option value="assault">–®—Ç—É—Ä–º–æ–≤—ã–µ</option>
        <option value="smg">–ü–ü</option>
        <option value="sniper">–°–Ω–∞–π–ø–µ—Ä—Å–∫–∏–µ</option>
        <option value="support">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</option>
        <option value="shotgun">–î—Ä–æ–±–æ–≤–∏–∫–∏</option>
      </select>
    </div>
    <div class="form-section" style="width:50%;">
      <select id="bf-category-filter" class="form-input">
        <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        <option value="popular">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</option>
        <option value="new">–ù–æ–≤–∏–Ω–∫–∏</option>
        <option value="topmeta">–¢–æ–ø –º–µ—Ç–∞</option>
        <option value="meta">–ú–µ—Ç–∞</option>
      </select>
    </div>
  </div>

  <div class="search-section">
    <input type="text" id="bf-builds-search" class="form-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é , –º–æ–¥—É–ª—è–º....">
  </div>

  <div class="form-section" style="display:flex;justify-content:space-between;align-items:center;">
    <h2>üì¶ –í—Å–µ —Å–±–æ—Ä–∫–∏</h2>
    <button id="bf-back-from-builds" class="btn btn-back">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

  <div id="bf-builds-list">
    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–±–æ—Ä–æ–∫...</p>
  </div>
  <p id="bf-no-results-message" style="display:none;text-align:center;margin-top:20px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
</div>


<!-- üõ† –î–æ–±–∞–≤–ª–µ–Ω–∏–µ / –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–±–æ—Ä–∫–∏ -->
<div id="screen-bf-form" class="screen" style="display:none;">
  <div class="form-section">
    <h2>üõ† –î–æ–±–∞–≤–ª–µ–Ω–∏–µ / —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–±–æ—Ä–∫–∏</h2>
  </div>

  <div class="form-section">
    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å–±–æ—Ä–∫–∏:</label>
    <input type="text" id="bf-title" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–±–æ—Ä–∫–∏">
  </div>

  <div class="form-section">
    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
    <div class="categories-grid">
      <label class="category-checkbox">
        <input type="checkbox" class="bf-build-category" value="popular">
        <span class="checkmark"></span>
        <span>–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</span>
      </label>
      <label class="category-checkbox">
        <input type="checkbox" class="bf-build-category" value="new">
        <span class="checkmark"></span>
        <span>–ù–æ–≤–∏–Ω–∫–∏</span>
      </label>
      <label class="category-checkbox">
        <input type="checkbox" class="bf-build-category" value="topmeta">
        <span class="checkmark"></span>
        <span>–¢–æ–ø –º–µ—Ç–∞</span>
      </label>
      <label class="category-checkbox">
        <input type="checkbox" class="bf-build-category" value="meta">
        <span class="checkmark"></span>
        <span>–ú–µ—Ç–∞</span>
      </label>
    </div>
  </div>

  <div class="form-section">
    <label>–¢–∏–ø –æ—Ä—É–∂–∏—è:</label>
    <select id="bf-weapon-type" class="form-input"></select>
  </div>

  <div class="form-section">
    <label>–¢–û–ü –º–æ–¥—É–ª–∏:</label>
    <div class="top-modules-grid">
      <input type="text" id="bf-top1" placeholder="ü•á –¢–æ–ø 1" class="form-input top-module-input">
      <input type="text" id="bf-top2" placeholder="ü•à –¢–æ–ø 2" class="form-input top-module-input">
      <input type="text" id="bf-top3" placeholder="ü•â –¢–æ–ø 3" class="form-input top-module-input">
    </div>
  </div>

  <div class="form-section">
    <label>–í–∫–ª–∞–¥–∫–∏ (–º–æ–¥—É–ª–∏):</label>
    <div id="bf-tabs-container"></div>
    <button type="button" id="bf-add-tab" class="btn add-tab-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–∫–ª–∞–¥–∫—É</button>
  </div>

  <div class="form-section">
    <label>–î–∞—Ç–∞:</label>
    <input type="date" id="bf-build-date" class="form-input">
  </div>

  <div class="btn-group">
    <button id="bf-submit-build" class="btn btn-primary">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–±–æ—Ä–∫—É</button>
    <button id="bf-back-from-form" class="btn btn-back">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>
</div>


<div id="screen-bf-edit-builds" class="screen" style="display:none;">
  <div class="screen-header">
    <button class="btn btn-back" id="bf-back-from-edit">‚¨Ö –ù–∞–∑–∞–¥</button>
    <h2>‚öôÔ∏è –ë–∞–∑–∞ —Å–±–æ—Ä–æ–∫ Battlefield</h2>
  </div>

  <div class="stats-bar">
    <span id="bf-builds-count">–í—Å–µ–≥–æ: 0 —Å–±–æ—Ä–æ–∫</span>
  </div>

  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <div class="bf-filters-container" style="padding: 16px; border-bottom: 1px solid #2a3a5a;">
    <div class="bf-filters-row" style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
      <div class="bf-filter-group" style="display: flex; gap: 8px; align-items: center;">
        <strong style="color: #e0e6ee; font-size: 14px;">–í—Å–µ —Ç–∏–ø—ã</strong>
        <select id="bf-edit-type-filter" class="bf-filter-select">
          <option value="all">–í—Å–µ</option>
        </select>
      </div>
            
      <div class="bf-search-group" style="flex: 1; min-width: 200px;">
        <input type="text" id="bf-edit-search" class="bf-search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...">
      </div>
    </div>
  </div>

  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ - 2 –≤ —Ä—è–¥ -->
  <div id="bf-edit-builds-grid" class="bf-builds-grid">
    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–±–æ—Ä–æ–∫...</p>
  </div>
</div>


<!-- üìö –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–æ–¥—É–ª–µ–π ‚Äî –≤—ã–±–æ—Ä —Ç–∏–ø–∞ -->
<div id="screen-bf-modules-types" class="screen" style="display:none;">
  <h2>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–æ–¥—É–ª–µ–π ‚Äî —Ç–∏–ø –æ—Ä—É–∂–∏—è</h2>
  <div id="bf-modules-types-grid" class="button-grid"></div>
  <button class="btn" id="bf-back-from-mod-types">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>


<!-- üìã –°–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ -->
<div id="screen-bf-modules-list" class="screen" style="display:none;">
  <button class="btn" id="bf-back-from-mod-list">‚¨Ö –ù–∞–∑–∞–¥</button>
  <h2 id="bf-modules-title">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–æ–¥—É–ª–µ–π</h2>

  <div id="bf-modules-toolbar" class="flex" style="gap:8px;margin-bottom:10px;flex-wrap:wrap;">
    <select id="bf-mod-category-select" class="form-input" style="min-width:180px;">
      <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é...</option>
    </select>
    
    <input id="bf-mod-category" class="form-input" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é">
    <input id="bf-mod-en" class="form-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ EN (–Ω–∞–ø—Ä–∏–º–µ—Ä: Compensator)">
    <button class="btn" id="bf-mod-add-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
  </div>


  <div id="bf-modules-list"></div>
</div>


<!-- üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —ç–∫—Ä–∞–Ω –∏—Å–ø—ã—Ç–∞–Ω–∏–π -->
<div id="screen-bf-challenges" class="screen" style="display:none;">
  <div class="screen-header">
    <h2>‚öîÔ∏è Battlefield | –ò—Å–ø—ã—Ç–∞–Ω–∏—è</h2>
    <p class="screen-subtitle">–í—ã–ø–æ–ª–Ω—è–π –∏—Å–ø—ã—Ç–∞–Ω–∏—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π –ø—Ä–æ–≥—Ä–µ—Å—Å</p>
  </div>

  <!-- üîç –ü–æ–∏—Å–∫ –∏ –≤–∫–ª–∞–¥–∫–∏ -->
  <div class="search-box">
    <input type="text" id="bf-search-user" placeholder="üîç –ü–æ–∏—Å–∫" class="search-input">
  </div>

  <div id="bf-tabs" class="tabs-grid"></div>

  <div class="status-tabs">
    <button class="status-btn" data-status="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</button>
    <button class="status-btn" data-status="completed">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</button>
  </div>


  <!-- üß© –°–ø–∏—Å–æ–∫ –∏—Å–ø—ã—Ç–∞–Ω–∏–π -->
  <div id="bf-challenges-list" class="challenges-grid">
    <div class="loading-spinner">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å–ø—ã—Ç–∞–Ω–∏–π...</div>
  </div>

    <button class="btn" id="bf-back-from-challenges">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>


<!-- üõ° –≠–∫—Ä–∞–Ω –±–∞–∑—ã –∏—Å–ø—ã—Ç–∞–Ω–∏–π (–¥–ª—è –∞–¥–º–∏–Ω–∞) -->
<div id="screen-bf-challenges-db" class="screen" style="display:none;">
  <div class="screen-header">
    <h2>üß© –ë–∞–∑–∞ –∏—Å–ø—ã—Ç–∞–Ω–∏–π Battlefield</h2>
    <p class="screen-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –∏—Å–ø—ã—Ç–∞–Ω–∏—è–º–∏ —Å–∏—Å—Ç–µ–º—ã</p>
  </div>

  <div class="btn-group" style="margin-bottom:20px;">
    <button class="btn btn-secondary" id="bf-back-to-bfmain">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>

  <div class="stats-bar">
    <div class="stat-item">
      <span class="stat-value" id="bf-total-challenges">0</span>
      <span class="stat-label">–í—Å–µ–≥–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–π</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" id="bf-total-categories">0</span>
      <span class="stat-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–π</span>
    </div>
  </div>

  <div class="search-box">
    <input type="text" id="bf-search-challenges" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." class="search-input">
    <select id="bf-filter-category" class="filter-select">
      <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
    </select>
  </div>

  <div id="bf-challenges-grid" class="challenges-grid">
    <div class="loading-spinner">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å–ø—ã—Ç–∞–Ω–∏–π...</div>
  </div>
</div>

<!-- üß± –≠–∫—Ä–∞–Ω –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø—ã—Ç–∞–Ω–∏—è -->
<div id="screen-bf-add-challenge" class="screen" style="display:none;">
  <div class="screen-header">
    <h2>üõ† –î–æ–±–∞–≤–∏—Ç—å –∏—Å–ø—ã—Ç–∞–Ω–∏–µ</h2>
  </div>

<div class="form-section">
  <label for="bf-category-select">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
  <select id="bf-category-select" class="form-input">
    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é...</option>
  </select>

  <div class="category-actions">
  <button class="btn-mini" id="bf-edit-category-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é">
    <i class="fas fa-edit"></i>
  </button>
  <button class="btn-mini" id="bf-delete-category-btn" title="–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é">
    <i class="fas fa-trash"></i>
  </button>
</div>


  <div class="add-category-inline">
    <input type="text" id="bf-new-category" class="form-input" placeholder="–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è">
    <button class="btn btn-secondary" id="bf-add-category-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–∫–ª–∞–¥–∫—É</button>
  </div>
</div>


  <div class="form-section">
    <label for="bf-title-en">–ù–∞–∑–≤–∞–Ω–∏–µ (EN)</label>
    <input type="text" id="bf-title-en" class="form-input" placeholder="Get 30 kills">
  </div>

  <div class="form-section">
    <label for="bf-title-ru">–ù–∞–∑–≤–∞–Ω–∏–µ (RU)</label>
    <input type="text" id="bf-title-ru" class="form-input" placeholder="–°–¥–µ–ª–∞–π—Ç–µ 30 —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–π">
  </div>

  <div class="form-section flex-row">
    <div class="form-col">
      <label for="bf-goal">–¶–µ–ª—å</label>
      <input type="number" id="bf-goal" class="form-input" value="0">
    </div>
  </div>

  <div class="btn-group">
    <button class="btn btn-primary" id="bf-submit-challenge">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="btn btn-back" id="bf-back-from-add">‚¨Ö –ù–∞–∑–∞–¥</button>
  </div>
</div>


<!-- üéõ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —ç–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
<div id="screen-bf-settings" class="screen" style="display:none;">
  <div class="screen-header" style="display:flex;align-items:center;gap:12px;">
    <button class="btn btn-back" id="bf-settings-back">‚¨Ö –ù–∞–∑–∞–¥</button>
    <button class="btn" id="bf-settings-burger">‚ò∞</button>
    <h2 id="bf-settings-current-title" style="margin-left:auto;">Accessibility</h2>
  </div>

  <!-- –í—ã–µ–∑–∂–∞—é—â–µ–µ –º–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
  <aside id="bf-settings-drawer" aria-hidden="true" style="position:fixed;left:-280px;top:0;height:100vh;width:260px;max-width:80vw;background:#111;box-shadow:2px 0 16px rgba(0,0,0,.4);transition:left .25s ease;z-index:20;padding:12px;">
    <h3 style="margin:8px 8px 12px;">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
    <nav id="bf-settings-categories" style="display:flex;flex-direction:column;gap:8px;"></nav>
  </aside>

  <div id="bf-settings-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:10;"></div>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
  <div id="bf-settings-content" style="margin-top:12px;">
    <div class="loading-spinner">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫...</div>
  </div>
</div>

<!-- üõ† –≠–∫—Ä–∞–Ω —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω) -->
<div id="screen-bf-settings-editor" class="screen" style="display:none;">
  <div class="screen-header" style="display:flex;align-items:center;gap:12px;">
    <button class="btn btn-back" id="bf-settings-editor-back">‚¨Ö –ù–∞–∑–∞–¥</button>
    <h2>–†–µ–¥–∞–∫—Ç–æ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫</h2>
  </div>

  <!-- –§–æ—Ä–º–∞ -->
  <div class="form-section" id="bf-settings-form">
    <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div>
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select id="bf-settings-category" class="form-input"></select>
      </div>
      <div>
        <label>–¢–∏–ø</label>
        <select id="bf-settings-type" class="form-input">
          <option value="toggle">Toggle</option>
          <option value="slider">Slider</option>
          <option value="number">Number</option>
          <option value="select">Select</option>
        </select>
      </div>
      <div>
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ (EN)</label>
        <input id="bf-settings-title-en" class="form-input" placeholder="Field of View">
      </div>
      <div>
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ (RU)</label>
        <input id="bf-settings-title-ru" class="form-input" placeholder="–ü–æ–ª–µ –∑—Ä–µ–Ω–∏—è">
      </div>
      <div id="bf-settings-default-wrap">
        <label>–ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label>
        <input id="bf-settings-default" class="form-input" placeholder="–ù–∞–ø—Ä., 90 / true / Low">
      </div>
      <div id="bf-settings-options-wrap" style="display:none;">
        <label>–û–ø—Ü–∏–∏ (–¥–ª—è select, —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
        <input id="bf-settings-options" class="form-input" placeholder="Low, Medium, High, Ultra">
      </div>
    </div>

    <div class="btn-group" style="margin-top:12px;">
      <button class="btn btn-primary" id="bf-settings-submit">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="btn" id="bf-settings-reset-form" type="button">–°–±—Ä–æ—Å</button>
    </div>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö -->
  <div class="form-section">
    <h3>–°–ø–∏—Å–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫</h3>
    <div id="bf-settings-list"></div>
  </div>
</div>




  <script src="/static/bf.js?v={{ version }}"></script>


<script>
/* ===============================
   BF SETTINGS ‚Äî VIEW & EDITOR
   =============================== */

(function() {
  // ‚Äî‚Äî‚Äî –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–∫–ª—é—á, EN, RU) ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Å–ø–∏—Å–æ–∫ —Ç—É—Ç
  const BF_SETTINGS_CATEGORIES = [
    { key: 'accessibility', en: 'Accessibility',    ru: '–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å' },
    { key: 'gameplay',      en: 'Gameplay',         ru: '–ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å' },
    { key: 'campaign',      en: 'Campaign',         ru: '–ö–∞–º–ø–∞–Ω–∏—è' },
    { key: 'controller',    en: 'Controller',       ru: '–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä' },
    { key: 'mousekeyboard', en: 'Mouse & Keyboard', ru: '–ú—ã—à—å –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞' },
    { key: 'graphics',      en: 'Graphics',         ru: '–ì—Ä–∞—Ñ–∏–∫–∞' },
    { key: 'audio',         en: 'Audio',            ru: '–ó–≤—É–∫' },
    { key: 'system',        en: 'System',           ru: '–°–∏—Å—Ç–µ–º–∞' },
  ];

  // ‚Äî‚Äî‚Äî –°–µ–ª–µ–∫—Ç–æ—Ä—ã —ç–∫—Ä–∞–Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  const scrView = document.getElementById('screen-bf-settings');
  const btnViewBack = document.getElementById('bf-settings-back');
  const btnBurger = document.getElementById('bf-settings-burger');
  const drawer = document.getElementById('bf-settings-drawer');
  const overlay = document.getElementById('bf-settings-overlay');
  const catsNav = document.getElementById('bf-settings-categories');
  const content = document.getElementById('bf-settings-content');
  const currentTitle = document.getElementById('bf-settings-current-title');

  // ‚Äî‚Äî‚Äî –°–µ–ª–µ–∫—Ç–æ—Ä—ã —ç–∫—Ä–∞–Ω–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
  const scrEdit = document.getElementById('screen-bf-settings-editor');
  const btnEditBack = document.getElementById('bf-settings-editor-back');
  const selCat = document.getElementById('bf-settings-category');
  const selType = document.getElementById('bf-settings-type');
  const inputEn = document.getElementById('bf-settings-title-en');
  const inputRu = document.getElementById('bf-settings-title-ru');
  const defWrap = document.getElementById('bf-settings-default-wrap');
  const inputDefault = document.getElementById('bf-settings-default');
  const optWrap = document.getElementById('bf-settings-options-wrap');
  const inputOptions = document.getElementById('bf-settings-options');
  const btnSubmit = document.getElementById('bf-settings-submit');
  const btnReset = document.getElementById('bf-settings-reset-form');
  const list = document.getElementById('bf-settings-list');

  // ‚Äî‚Äî‚Äî –ö–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞ –Ω–∞ —ç–∫—Ä–∞–Ω—ã —Å –≥–ª–∞–≤–Ω–æ–≥–æ
  const btnOpenUser = document.getElementById('bf-settings-btn');       // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  const btnOpenEditor = document.getElementById('bf-game-settings-btn'); // –ê–¥–º–∏–Ω

  // ‚Äî‚Äî‚Äî –°–æ—Å—Ç–æ—è–Ω–∏–µ
  let currentCategoryKey = 'accessibility';
  let editingId = null;

  // ‚Äî‚Äî‚Äî API (–ø–æ—Å—Ç–∞–≤—å —Å–≤–æ–∏ –º–∞—Ä—à—Ä—É—Ç—ã, –µ—Å–ª–∏ –¥—Ä—É–≥–∏–µ)
  async function apiGetSettings(categoryKey = '') {
    const url = categoryKey ? `/api/bf/settings?category=${encodeURIComponent(categoryKey)}` : '/api/bf/settings';
    const r = await fetch(url);
    if (!r.ok) throw new Error('Failed to load settings');
    return r.json();
  }
  async function apiCreateSetting(payload) {
    const r = await fetch('/api/bf/settings', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload),
    });
    if (!r.ok) throw new Error('Failed to create');
    return r.json();
  }
  async function apiUpdateSetting(id, payload) {
    const r = await fetch(`/api/bf/settings/${id}`, {
      method: 'PUT',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload),
    });
    if (!r.ok) throw new Error('Failed to update');
    return r.json();
  }
  async function apiDeleteSetting(id) {
    const r = await fetch(`/api/bf/settings/${id}`, { method: 'DELETE' });
    if (!r.ok) throw new Error('Failed to delete');
    return r.json();
  }

  // ‚Äî‚Äî‚Äî –£—Ç–∏–ª–∏—Ç—ã
  function categoryByKey(key) {
    return BF_SETTINGS_CATEGORIES.find(c => c.key === key) || BF_SETTINGS_CATEGORIES[0];
  }
  function openDrawer() {
    drawer.style.left = '0';
    overlay.style.display = 'block';
    drawer.setAttribute('aria-hidden', 'false');
  }
  function closeDrawer() {
    drawer.style.left = '-280px';
    overlay.style.display = 'none';
    drawer.setAttribute('aria-hidden', 'true');
  }
  function clearForm() {
    editingId = null;
    selCat.value = currentCategoryKey || 'accessibility';
    selType.value = 'toggle';
    inputEn.value = '';
    inputRu.value = '';
    inputDefault.value = '';
    inputOptions.value = '';
    optWrap.style.display = 'none';
  }

  // ‚Äî‚Äî‚Äî –†–µ–Ω–¥–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –±—É—Ä–≥–µ—Ä-–º–µ–Ω—é
  function renderCategoriesNav() {
    catsNav.innerHTML = '';
    BF_SETTINGS_CATEGORIES.forEach(cat => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'btn';
      btn.style.textAlign = 'left';
      btn.textContent = `${cat.en} ‚Äî ${cat.ru}`;
      btn.dataset.key = cat.key;
      btn.onclick = () => {
        currentCategoryKey = cat.key;
        currentTitle.textContent = cat.en;
        closeDrawer();
        renderUserSettings(); // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫
      };
      catsNav.appendChild(btn);
    });
  }

  // ‚Äî‚Äî‚Äî –†–µ–Ω–¥–µ—Ä –æ–¥–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, read-only)
  function renderUserSettingRow(item) {
    const wrap = document.createElement('div');
    wrap.className = 'setting-row';
    wrap.style.cssText = 'padding:12px;border-bottom:1px solid rgba(255,255,255,.08)';
    const title = document.createElement('div');
    title.style.fontWeight = '600';
    title.textContent = item.title_en || 'Setting';
    const sub = document.createElement('div');
    sub.style.cssText = 'font-size:12px;opacity:.7;margin-top:2px';
    sub.textContent = item.title_ru || '';
    const val = document.createElement('div');
    val.style.cssText = 'margin-top:6px;opacity:.85';

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª, –Ω–æ –¥–µ–ª–∞–µ–º –µ–≥–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º
    switch (item.type) {
      case 'toggle': {
        const chk = document.createElement('input');
        chk.type = 'checkbox';
        chk.disabled = true;
        chk.checked = !!item.default;
        val.appendChild(chk);
        break;
      }
      case 'slider': {
        const rng = document.createElement('input');
        rng.type = 'range';
        rng.disabled = true;
        rng.value = Number(item.default) || 0;
        val.appendChild(rng);
        break;
      }
      case 'number': {
        const num = document.createElement('input');
        num.type = 'number';
        num.disabled = true;
        num.value = item.default ?? '';
        val.appendChild(num);
        break;
      }
      case 'select': {
        const sel = document.createElement('select');
        sel.disabled = true;
        (item.options || []).forEach(opt => {
          const o = document.createElement('option');
          o.value = opt;
          o.textContent = opt;
          if (item.default === opt) o.selected = true;
          sel.appendChild(o);
        });
        val.appendChild(sel);
        break;
      }
      default:
        val.textContent = String(item.default ?? '');
    }

    wrap.appendChild(title);
    wrap.appendChild(sub);
    wrap.appendChild(val);
    return wrap;
  }

  // ‚Äî‚Äî‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –≤—ã–≤–æ–¥ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  async function renderUserSettings() {
    content.innerHTML = '<div class="loading-spinner">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫...</div>';
    try {
      const data = await apiGetSettings(currentCategoryKey);
      content.innerHTML = '';
      if (!data || !data.length) {
        const p = document.createElement('p');
        p.style.opacity = '.7';
        p.textContent = '–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.';
        content.appendChild(p);
        return;
      }
      data.forEach(item => content.appendChild(renderUserSettingRow(item)));
    } catch (e) {
      content.innerHTML = '<p style="color:#f55">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫</p>';
      console.error(e);
    }
  }

  // ‚Äî‚Äî‚Äî –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
  async function renderEditorList() {
    list.innerHTML = '<div class="loading-spinner">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
    try {
      const data = await apiGetSettings(); // –≤—Å–µ
      // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
      const byCat = {};
      data.forEach(s => {
        byCat[s.category] ||= [];
        byCat[s.category].push(s);
      });

      list.innerHTML = '';
      BF_SETTINGS_CATEGORIES.forEach(cat => {
        const items = byCat[cat.key] || [];
        const section = document.createElement('div');
        section.style.marginBottom = '16px';
        const h = document.createElement('h4');
        h.textContent = `${cat.en} ‚Äî ${cat.ru} (${items.length})`;
        section.appendChild(h);

        if (!items.length) {
          const empty = document.createElement('div');
          empty.style.opacity = '.6';
          empty.textContent = '‚Äî –Ω–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤ ‚Äî';
          section.appendChild(empty);
        } else {
          items.forEach(it => {
            const row = document.createElement('div');
            row.style.cssText = 'display:flex;align-items:center;gap:8px;justify-content:space-between;border:1px solid rgba(255,255,255,.08);padding:8px;border-radius:8px;margin-top:8px;';
            const left = document.createElement('div');
            left.innerHTML = `<strong>${it.title_en}</strong><div style="font-size:12px;opacity:.7">${it.title_ru || ''}</div><div style="font-size:12px;opacity:.6">type: ${it.type} ‚Ä¢ default: ${it.default ?? ''}</div>`;
            const right = document.createElement('div');
            const btnE = document.createElement('button');
            btnE.className = 'btn';
            btnE.textContent = '‚úèÔ∏è';
            btnE.title = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
            btnE.onclick = () => {
              editingId = it.id;
              selCat.value = it.category;
              selType.value = it.type;
              inputEn.value = it.title_en || '';
              inputRu.value = it.title_ru || '';
              inputDefault.value = it.default ?? '';
              if (it.type === 'select') {
                optWrap.style.display = 'block';
                inputOptions.value = (it.options || []).join(', ');
              } else {
                optWrap.style.display = 'none';
                inputOptions.value = '';
              }
              // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —Ñ–æ—Ä–º–µ
              document.getElementById('bf-settings-form').scrollIntoView({behavior:'smooth'});
            };
            const btnD = document.createElement('button');
            btnD.className = 'btn';
            btnD.textContent = 'üóë';
            btnD.title = '–£–¥–∞–ª–∏—Ç—å';
            btnD.onclick = async () => {
              if (!confirm('–£–¥–∞–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É?')) return;
              try {
                await apiDeleteSetting(it.id);
                await renderEditorList();
              } catch (e) {
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
                console.error(e);
              }
            };
            right.appendChild(btnE);
            right.appendChild(btnD);
            row.appendChild(left);
            row.appendChild(right);
            section.appendChild(row);
          });
        }

        list.appendChild(section);
      });
    } catch (e) {
      list.innerHTML = '<p style="color:#f55">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
      console.error(e);
    }
  }

  // ‚Äî‚Äî‚Äî –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª–µ –æ–ø—Ü–∏–π –¥–ª—è select)
  selType?.addEventListener('change', () => {
    const isSelect = selType.value === 'select';
    optWrap.style.display = isSelect ? 'block' : 'none';
  });

  // ‚Äî‚Äî‚Äî –°–∞–±–º–∏—Ç —Ñ–æ—Ä–º—ã
  btnSubmit?.addEventListener('click', async () => {
    const payload = {
      category: selCat.value,
      title_en: (inputEn.value || '').trim(),
      title_ru: (inputRu.value || '').trim(),
      type: selType.value,
      default: inputDefault.value,
      options: selType.value === 'select'
        ? (inputOptions.value || '').split(',').map(s => s.trim()).filter(Boolean)
        : [],
    };
    if (!payload.category || !payload.title_en) {
      alert('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ EN –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã');
      return;
    }
    try {
      if (editingId) {
        await apiUpdateSetting(editingId, payload);
      } else {
        await apiCreateSetting(payload);
      }
      clearForm();
      await renderEditorList();
    } catch (e) {
      alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
      console.error(e);
    }
  });

  btnReset?.addEventListener('click', clearForm);

  // ‚Äî‚Äî‚Äî –û—Ç–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π
  btnOpenUser?.addEventListener('click', () => {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    renderCategoriesNav();
    currentCategoryKey = currentCategoryKey || 'accessibility';
    currentTitle.textContent = categoryByKey(currentCategoryKey).en;
    renderUserSettings();
    if (typeof showScreen === 'function') showScreen('screen-bf-settings');
  });

  btnOpenEditor?.addEventListener('click', () => {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    selCat.innerHTML = BF_SETTINGS_CATEGORIES.map(c => `<option value="${c.key}">${c.en} ‚Äî ${c.ru}</option>`).join('');
    selCat.value = currentCategoryKey || 'accessibility';
    clearForm();
    renderEditorList();
    if (typeof showScreen === 'function') showScreen('screen-bf-settings-editor');
  });

  // ‚Äî‚Äî‚Äî –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ —ç–∫—Ä–∞–Ω–æ–≤
  btnViewBack?.addEventListener('click', () => {
    if (typeof showScreen === 'function') showScreen('screen-battlefield-main');
  });
  btnEditBack?.addEventListener('click', () => {
    if (typeof showScreen === 'function') showScreen('screen-battlefield-main');
  });

  // ‚Äî‚Äî‚Äî –ë—É—Ä–≥–µ—Ä
  btnBurger?.addEventListener('click', openDrawer);
  overlay?.addEventListener('click', closeDrawer);

})(); 
</script>

