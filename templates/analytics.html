<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ NDHQ</title>
  <style>
    header {
      background: #171d25;
      padding: 20px;
      text-align: center;
      border-bottom: 2px solid #2a3545;
    }
    header h1 {
      margin: 0;
      font-size: 28px;
      color: #00ffcc;
    }
    header p {
      margin: 5px 0 0;
      color: #aaa;
    }
    .container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 15px;
    }
    h2 {
      margin-top: 30px;
      color: #00ccff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #333;
      padding: 8px 10px;
      text-align: left;
      word-break: break-word;
    }
    th {
      background: #1c222d;
      color: #00ffcc;
    }
    tr:nth-child(even) {
      background: #151b24;
    }
    tr:hover {
      background: #223044;
    }
    footer {
      text-align: center;
      padding: 15px;
      color: #777;
      border-top: 1px solid #222;
      margin-top: 40px;
    }
  </style>
  <script>
    async function loadData() {
      try {
        const res = await fetch("/api/analytics/latest");
        const data = await res.json();

        // —Å–æ–±—ã—Ç–∏—è
        const analyticsBody = document.getElementById("analytics-body");
        analyticsBody.innerHTML = "";
        data.analytics.forEach(row => {
          analyticsBody.innerHTML += `
            <tr>
              <td>${row.user_id}</td>
              <td>${row.action}</td>
              <td>${row.details}</td>
              <td>${row.timestamp}</td>
            </tr>
          `;
        });

        // –æ—à–∏–±–∫–∏
        const errorsBody = document.getElementById("errors-body");
        errorsBody.innerHTML = "";
        data.errors.forEach(row => {
          errorsBody.innerHTML += `
            <tr>
              <td>${row.user_id}</td>
              <td>${row.error}</td>
              <td>${row.details}</td>
              <td>${row.timestamp}</td>
            </tr>
          `;
        });

        document.getElementById("last-update").textContent =
          "–û–±–Ω–æ–≤–ª–µ–Ω–æ: " + new Date().toLocaleTimeString();
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:", e);
      }
    }

    setInterval(loadData, 10000); // –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
    window.onload = loadData;
  </script>
</head>
<body>
  <header>
    <h1>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π NDHQ</h1>
    <p id="last-update">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
  </header>

  <div class="container">
    <h2>–î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
    <table>
      <thead>
        <tr>
          <th>User ID</th>
          <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
          <th>–î–µ—Ç–∞–ª–∏</th>
          <th>–í—Ä–µ–º—è</th>
        </tr>
      </thead>
      <tbody id="analytics-body"></tbody>
    </table>

    <h2>–û—à–∏–±–∫–∏</h2>
    <table>
      <thead>
        <tr>
          <th>User ID</th>
          <th>–û—à–∏–±–∫–∞</th>
          <th>–î–µ—Ç–∞–ª–∏</th>
          <th>–í—Ä–µ–º—è</th>
        </tr>
      </thead>
      <tbody id="errors-body"></tbody>
    </table>
  </div>

  <footer>
    NDHQ ¬© 2025 ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
  </footer>
</body>
</html>
