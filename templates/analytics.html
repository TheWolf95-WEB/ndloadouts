<!-- analytics.html - –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è –∏ –∫—Ä–∞—Å–∏–≤–∞—è –≤–µ—Ä—Å–∏—è -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ NDHQ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: #0f111a;
      color: #ffffff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      text-align: center;
      padding: 30px 0;
      background: linear-gradient(135deg, #171d25 0%, #1c222d 100%);
      border-bottom: 2px solid #00ffcc;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 28px;
      color: #00ffcc;
      margin-bottom: 10px;
    }
    
    .header p {
      color: #aaa;
      font-size: 14px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: #171d25;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      border: 1px solid #2a3545;
      transition: transform 0.2s;
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
      border-color: #00ffcc;
    }
    
    .stat-number {
      font-size: 32px;
      font-weight: bold;
      color: #00ffcc;
      margin-bottom: 5px;
    }
    
    .stat-label {
      color: #aaa;
      font-size: 14px;
    }
    
    .dashboard {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }
    
    @media (max-width: 768px) {
      .dashboard {
        grid-template-columns: 1fr;
      }
    }
    
    .panel {
      background: #171d25;
      border-radius: 12px;
      border: 1px solid #2a3545;
      overflow: hidden;
    }
    
    .panel-header {
      background: #1c222d;
      padding: 20px;
      border-bottom: 1px solid #2a3545;
    }
    
    .panel-header h2 {
      color: #00ccff;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .panel-content {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .user-list, .activity-list {
      list-style: none;
    }
    
    .user-item, .activity-item {
      padding: 15px 20px;
      border-bottom: 1px solid #2a3545;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: background 0.2s;
    }
    
    .user-item:hover, .activity-item:hover {
      background: #223044;
    }
    
    .user-item:last-child, .activity-item:last-child {
      border-bottom: none;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #00ffcc;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #0f111a;
      flex-shrink: 0;
    }
    
    .user-info {
      flex: 1;
      min-width: 0;
    }
    
    .user-name {
      font-weight: 500;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .user-meta {
      display: flex;
      gap: 15px;
      font-size: 12px;
      color: #aaa;
    }
    
    .activity-content {
      flex: 1;
      min-width: 0;
    }
    
    .activity-text {
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .activity-time {
      font-size: 12px;
      color: #00ccff;
    }
    
    .status-online {
      color: #00ff88;
    }
    
    .status-offline {
      color: #888;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #666;
    }
    
    .footer {
      text-align: center;
      padding: 20px;
      color: #666;
      font-size: 14px;
      border-top: 1px solid #2a3545;
      margin-top: 30px;
    }
    
    .last-update {
      text-align: center;
      margin-bottom: 20px;
      color: #00ccff;
      font-size: 14px;
    }
    
    .refresh-btn {
      background: #00ffcc;
      color: #0f111a;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin: 10px auto;
      display: block;
      transition: background 0.2s;
    }
    
    .refresh-btn:hover {
      background: #00e6b8;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ NDHQ</h1>
    <p>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
  </div>

  <div class="container">
    <div class="last-update" id="last-update">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    
    <button class="refresh-btn" onclick="loadData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid" id="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="total-users">0</div>
        <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="online-users">0</div>
        <div class="stat-label">–°–µ–π—á–∞—Å –æ–Ω–ª–∞–π–Ω</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="total-actions">0</div>
        <div class="stat-label">–í—Å–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–π</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="total-errors">0</div>
        <div class="stat-label">–û—à–∏–±–æ–∫</div>
      </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="dashboard">
      <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
      <div class="panel">
        <div class="panel-header">
          <h2>üë• –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
        </div>
        <div class="panel-content">
          <ul class="user-list" id="user-list">
            <li class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</li>
          </ul>
        </div>
      </div>

      <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
      <div class="panel">
        <div class="panel-header">
          <h2>üìà –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
        </div>
        <div class="panel-content">
          <ul class="activity-list" id="activity-list">
            <li class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏...</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    NDHQ ¬© 2025 ‚Äî –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
  </div>

  <script>
    async function loadData() {
      try {
        console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏...');
        const response = await fetch("/api/analytics/dashboard");
        
        if (!response.ok) {
          throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
        }
        
        const data = await response.json();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.getElementById('total-users').textContent = data.stats.total_users;
        document.getElementById('online-users').textContent = data.stats.online_users;
        document.getElementById('total-actions').textContent = data.stats.total_actions;
        document.getElementById('total-errors').textContent = data.stats.total_errors;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        const userList = document.getElementById('user-list');
        if (data.all_users.length > 0) {
          userList.innerHTML = data.all_users.map(user => `
            <li class="user-item">
              <div class="user-avatar">${user.user.charAt(0).toUpperCase()}</div>
              <div class="user-info">
                <div class="user-name">${user.user}</div>
                <div class="user-meta">
                  <span class="${user.status === 'üü¢' ? 'status-online' : 'status-offline'}">${user.status}</span>
                  <span>${user.platform}</span>
                  <span>${user.actions} –¥–µ–π—Å—Ç–≤–∏–π</span>
                </div>
              </div>
              <div class="activity-time">${user.last_seen}</div>
            </li>
          `).join('');
        } else {
          userList.innerHTML = '<li class="empty-state">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö</li>';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        const activityList = document.getElementById('activity-list');
        if (data.recent_actions.length > 0) {
          activityList.innerHTML = data.recent_actions.map(activity => `
            <li class="activity-item">
              <div class="activity-platform">${activity.platform}</div>
              <div class="activity-content">
                <div class="activity-text">
                  <strong>${activity.user}</strong> ‚Äî ${activity.action}
                </div>
                <div class="activity-time">${activity.time}</div>
              </div>
            </li>
          `).join('');
        } else {
          activityList.innerHTML = '<li class="empty-state">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</li>';
        }
        
        document.getElementById('last-update').textContent = 
          `‚è± –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date().toLocaleTimeString()}`;
          
        console.log('‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        document.getElementById('last-update').textContent = 
          `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`;
      }
    }

    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
    setInterval(loadData, 15000);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    window.addEventListener('load', loadData);
  </script>
</body>
</html>
